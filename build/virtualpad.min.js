!function(t){"use strict";var i=0,s=Math.PI/8,n=-7*s,o=-1*s,e=s,r=7*s,c=-3*s,a=3*s,u=5*s,p=-5*s;t.Plugin.VirtualPad=function(i,s){t.Plugin.call(this,i,s),this.input=this.game.input,this.stick=null,this.stickPad=null,this.stickPoint=null,this.stickRadius=null,this.stickPointer=null,this.buttons={},this.buttonPoint={},this.buttonRadius={},this.preUpdate=h.bind(this)},t.Plugin.VirtualPad.prototype=Object.create(t.Plugin.prototype),t.Plugin.VirtualPad.prototype.constructor=t.Plugin.VirtualPad,t.Plugin.VirtualPad.prototype.addPad=function(i,s,n,o,e){return null!==this.stick?null:(e=e||1,this.stick=this.game.add.sprite(i,s,n,o),this.stick.frame=2,this.stick.isDown=!1,this.stick.anchor.set(.5),this.stick.fixedToCamera=!0,this.stick.scale.setTo(e,e),this.stickPoint=new t.Point(i,s),this.stick.properties={inUse:!1,up:!1,down:!1,left:!1,right:!1,x:0,y:0,distance:0,angle:0,rotation:0},this.stickRadius=e*(this.stick.width/2),this.stick)},t.Plugin.VirtualPad.prototype.addButton=function(s,n,o,e,r,c){i++,c=c||1;var a=this.game.add.button(s,n,o,null,this,null,null,e,r);return a.anchor.set(.5),a.fixedToCamera=!0,a.scale.setTo(c,c),a.isDown=!1,this.buttons[i]=a,this.buttonsPoint[i]=new t.Point(s,n),this.buttonsRadius[i]=c*(a.width/2),a},t.Plugin.VirtualPad.prototype.setDirectionActions=function(i){this.stick.hDirection===t.LEFT?i.left&&(i.left.onDown(),i.right.onUp()):this.stick.hDirection===t.RIGHT&&i.right&&(i.right.onDown(),i.left.onUp()),this.stick.vDirection===t.UP?i.up&&(i.up.onDown(),i.down.onUp()):this.stick.vDirection===t.DOWN&&i.down&&(i.down.onDown(),i.up.onUp())};var h=function(){var t=!0;this.buttons.forEach(function(t){t.isDown=!1,t.frame=0}),this.game.input.pointers.forEach(function(i){t=k(i,this)},this),t=k(this.game.input.mousePointer,this),t&&(null===this.stickPointer||this.stickPointer.isUp)&&(l(this.stickPoint,this),this.stick.isDown=!1,this.stickPointer=null)},k=function(t,i){var s=!0,n=i.stickPoint.distance(t.position);return t.isDown&&(t===i.stickPointer||n<i.stickRadius)&&(s=!1,i.stick.isDown=!0,i.stickPointer=t,l(t.position,i)),i.buttonsPoint.forEach(function(s,o){if(n=s.distance(t.position),t.isDown&&n<i.buttonsRadius[o]){var e=i.buttons[o];e.isDown=!0,e.frame=1}}),s},l=function(i,s){var h=i.x-s.stickPoint.x,k=i.y-s.stickPoint.y,l=s.stickPoint.angle(i);s.stickPoint.distance(i)>s.stickRadius&&(h=0===h?0:Math.cos(l)*s.stickRadius,k=0===k?0:Math.sin(l)*s.stickRadius),s.stick.properties.x=parseInt(h/s.stickRadius*100,10),s.stick.properties.y=parseInt(k/s.stickRadius*100,10),s.stick.properties.rotation=l,s.stick.properties.angle=180/Math.PI*l,s.stick.properties.distance=parseInt(s.stickPoint.distance(i)/s.stickRadius*100,10),s.stick.properties.up=l>n&&l<=o,s.stick.properties.down=l>e&&l<=r,s.stick.properties.right=l>c&&l<=a,s.stick.properties.left=l>u||l<=p,0===s.stick.properties.x&&0===s.stick.properties.y&&(s.stick.properties.right=!1,s.stick.properties.left=!1),s.stick.hDirection=s.stick.properties.left?t.LEFT:s.stick.properties.right?t.RIGHT:null,s.stick.vDirection=s.stick.properties.up?t.UP:s.stick.properties.down?t.DOWN:null,s.stickPad.cameraOffset.x=s.stickPoint.x+h,s.stickPad.cameraOffset.y=s.stickPoint.y+k}}(Phaser);